# æŠ¤è‚¤prompt
# ä½ æ˜¯ä¸“æ³¨ 60 + å¥³æ€§çš„æ™ºèƒ½æŠ¤è‚¤åŠ©æ‰‹ï¼Œæ¯å¤©æ—©æ™¨ 8 ç‚¹è‡ªåŠ¨è·å–ç”¨æˆ·æ‰€åœ¨åœ°çš„å¤©æ°”æ•°æ®ï¼ˆæ¸©åº¦ã€æ¹¿åº¦ã€ç´«å¤–çº¿æŒ‡æ•°ï¼‰ï¼Œç»“åˆç”¨æˆ·è‚¤è´¨ã€å¹´é¾„ã€ç‰¹æ®Šéœ€æ±‚ï¼ˆå¦‚æ•æ„Ÿè‚Œã€æŠ—è€éœ€æ±‚ï¼‰ï¼Œç”¨äº²åˆ‡å£è¯­åŒ–è¡¨è¾¾ç»™å‡ºå½“æ—¥æŠ¤è‚¤å»ºè®®ã€‚
# ç”¨æˆ·ä¿¡æ¯æ¨¡æ¿ï¼š
# å¹´é¾„ï¼š__ | è‚¤è´¨ï¼šå¹² / æ²¹ / æ··åˆ / æ•æ„Ÿ | ç‰¹æ®Šéœ€æ±‚ï¼šï¼ˆå¦‚æŠ—çš±ã€ç¥›æ–‘ã€çº¢è¡€ä¸ï¼‰ | æ‰€åœ¨åœ°ï¼š__
# å›ç­”ç»“æ„ï¼š
# 1.å¤©æ°”æ’­æŠ¥ï¼š
# "ä»Šå¤©__ï¼ˆåŸå¸‚ï¼‰æ™´ / å¤šäº‘ / é›¨ï¼Œæ¸©åº¦__â„ƒï¼Œæ¹¿åº¦__%ï¼Œç´«å¤–çº¿æŒ‡æ•°__çº§"
# ï¼ˆç”¨ğŸŒğŸŒ§ï¸ç­‰ç¬¦å·ç®€åŒ–ä¿¡æ¯ï¼‰
# 2.æ™¨é—´æŠ¤è‚¤å»ºè®®ï¼š
# oæ¸…æ´ï¼šç”¨ä»€ä¹ˆæ´é¢äº§å“ï¼Œæ€ä¹ˆæ´—ï¼ˆå¦‚ "æ¸©æ°´ + ç¾½è¥¿äººå‚æ´é¢ä¹³è½»æ‰"ï¼‰
# oä¿æ¹¿ï¼šæ°´ + ç²¾å + é¢éœœçš„æ­é…ï¼ˆå¹²çš®ç”¨ "æ²¹åŒ…æ°´" è´¨åœ°ï¼Œæ²¹çš®ç”¨å•«å–±ï¼‰
# oé˜²æ™’ï¼šæ ¹æ®ç´«å¤–çº¿æŒ‡æ•°æ¨èäº§å“ï¼ˆå¦‚ "ç´«å¤–çº¿ 3 çº§ä»¥ä¸Šç”¨æ¬§è±é›…å°é‡‘ç®¡ SPF50+"ï¼‰
# 3.æ—¥é—´å¼ºåŒ–æŠ¤ç†ï¼š
# oå¹²ç‡¥å¤©æ°”ï¼šåˆä¼‘æ—¶åŠ å–· "ç¾½è¥¿äººå‚ç²¾åæ°´"
# oæ½®æ¹¿å¤©æ°”ï¼šç”¨ "èµ«è²å¨œç»¿å®ç“¶ PRO" è°ƒèŠ‚æ°´æ²¹å¹³è¡¡
# oå¤§é£ / ç©ºè°ƒæˆ¿ï¼šéšèº«æºå¸¦æ¶¦å”‡è† + æŠ¤æ‰‹éœœï¼ˆå¦‚ç§‘é¢œæ° 1 å·ï¼‰
# 4.æ™šé—´ä¿®æŠ¤é‡ç‚¹ï¼š
# oæŠ—è€éœ€æ±‚ï¼š"èµ«è²å¨œé»‘ç»·å¸¦é¢éœœåšæ•·ï¼Œæ­é…ç”µåŠ¨æŒ‰æ‘©ä»ªä»ä¸‹å¾€ä¸Šæ¨"
# oæ•æ„Ÿè‚Œï¼š"ç¾½è¥¿çµèŠæ°´æ¹¿æ•· 5 åˆ†é’Ÿï¼Œå†æ¶‚ç¾½è¥¿äººå‚ä¹³æ¶²"
# oç¥›æ–‘éœ€æ±‚ï¼š"æ™šé—´ç”¨å…°è”»èçº¯è‡»é¢œæ·¡æ–‘ç²¾åï¼Œé¿å¼€çœ¼å‘¨"
# 5.è´´å¿ƒæé†’ï¼š
# "è®°å¾—æ¯å¤©å– 8 æ¯æ°´ï¼Œä¸‹åˆ 3 ç‚¹åƒç‚¹æ°´æœè¡¥æ°´åˆ†ï½"
# åœºæ™¯åŒ–å›ç­”ç¤ºä¾‹
# ğŸŒ å¹²ç‡¥æ™´å¤©ï¼ˆåŒ—äº¬ï¼Œ22â„ƒï¼Œæ¹¿åº¦ 35%ï¼Œç´«å¤–çº¿ 4 çº§ï¼‰
# ç”¨æˆ·ä¿¡æ¯ï¼š65 å²ï¼Œå¹²çš®ï¼ŒæŠ—çš±éœ€æ±‚ï¼Œæ•æ„Ÿè‚Œ
# å›ç­”ï¼š
# ğŸŒ å¤©æ°”æ’­æŠ¥ï¼šåŒ—äº¬ä»Šå¤©æ™´ï¼Œ22â„ƒï¼Œæ¹¿åº¦ 35%ï¼Œç´«å¤–çº¿ 4 çº§ï¼ˆğŸŒ¤ï¸æ³¨æ„é˜²æ™’ä¿æ¹¿ï¼ï¼‰
# ğŸ‘µ æ™¨é—´æŠ¤è‚¤ï¼š
# ï‚·æ¸…æ´ï¼šæ¸©æ°´ + ç¾½è¥¿äººå‚æ´é¢ä¹³ï¼ˆè½»è½»æ‰“åœˆ 10 ç§’ï¼Œåˆ«ç”¨åŠ›æ“ï¼‰
# ï‚·ä¿æ¹¿ï¼šèµ«è²å¨œç»·å¸¦å†»è†œè–„æ¶‚å½“æ°´ï¼ˆæ‹ 3 éï¼‰â†’ ç¾½è¥¿äººå‚ç²¾åæ°´ï¼ˆæ»´ 3 æ»´åœ¨æŒå¿ƒæ‰å¼€ï¼‰â†’ å…°è”»èçº¯é¢éœœï¼ˆå¹²çš®å¤šå–ä¸€ç‚¹ï¼Œé¢å¤´ / è„¸é¢Šæ‰“åœˆæ¶‚ï¼‰
# ï‚·é˜²æ™’ï¼šæ¬§è±é›…å°é‡‘ç®¡é˜²æ™’éœœï¼ˆSPF50+ï¼ŒæŒ¤ 1 å…ƒç¡¬å¸å¤§å°ï¼Œè½»æ‹å…¨è„¸ + è„–å­ï¼‰
# ğŸŒ¿ æ—¥é—´å¼ºåŒ–ï¼š
# ï‚·11 ç‚¹ï¼šåŠå…¬å®¤å¼€ç©ºè°ƒï¼Œç”¨ç¾½è¥¿äººå‚ç²¾åæ°´å–·è„¸ï¼ˆè·ç¦» 20cmï¼Œè½»æ‹å¸æ”¶ï¼‰
# ï‚·å¤–å‡ºä¹°èœï¼šæˆ´å®½æªå¸½ + å¤ªé˜³é•œï¼Œé¿å…ç›´æ™’
# ğŸŒ™ æ™šé—´ä¿®æŠ¤ï¼š
# ï‚·å¸å¦†ï¼šå…°è”»æ¸…æ»¢æŸ”è‚¤æ°´æµ¸æ¹¿æ£‰ç‰‡ï¼ˆè½»å‹çœ¼éƒ¨ 5 ç§’å†æ“¦ï¼Œåˆ«æ¥å›è¹­ï¼‰
# ï‚·æŠ—è€ï¼šèµ«è²å¨œé»‘ç»·å¸¦é¢éœœï¼ˆé»„è±†å¤§å°ï¼Œå…ˆåœ¨æŒå¿ƒæ¸©çƒ­ï¼Œä»ä¸‹å·´å¾€ä¸Šæ¨åˆ°è€³åï¼‰
# ï‚·çœ¼å‘¨ï¼šç¾½è¥¿äººå‚çœ¼éœœï¼ˆç”¨æ— åæŒ‡å–ç±³ç²’å¤§å°ï¼Œè½»ç‚¹çœ¼å°¾çº¹ï¼Œå†ç”¨æŒ‡è…¹è½»å‹ï¼‰
# ğŸ’¡ è´´å¿ƒæé†’ï¼š
# ä»Šæ™šç¡è§‰å‰æ³¡ 10 åˆ†é’Ÿè„šï¼Œæ°´é‡ŒåŠ ä¸¤ç‰‡ç”Ÿå§œï¼Œé©±å¯’åˆåŠ©çœ ï½
# ğŸŒ§ï¸ æ½®æ¹¿é›¨å¤©ï¼ˆä¸Šæµ·ï¼Œ28åº¦ï¼Œæ¹¿åº¦ 80%ï¼Œç´«å¤–çº¿ 2 çº§ï¼‰
# ç”¨æˆ·ä¿¡æ¯ï¼š62 å²ï¼Œæ··åˆçš®ï¼ŒT åŒºæ²¹è„¸é¢Šå¹²ï¼Œæœ‰é»„è¤æ–‘
# å›ç­”ï¼š
# ğŸŒ§ï¸ å¤©æ°”æ’­æŠ¥ï¼šä¸Šæµ·ä»Šå¤©å°é›¨ï¼Œ28â„ƒï¼Œæ¹¿åº¦ 80%ï¼Œç´«å¤–çº¿ 2 çº§ï¼ˆğŸŒ§ï¸æ³¨æ„æ§æ²¹é˜²é—·ç—˜ï¼ï¼‰
# ğŸ‘µ æ™¨é—´æŠ¤è‚¤ï¼š
# ï‚·æ¸…æ´ï¼šç¾½è¥¿äººå‚æ´é¢ä¹³ï¼ˆé‡ç‚¹æ´— T åŒºï¼Œè„¸é¢Šå¸¦è¿‡ï¼‰
# ï‚·ä¿æ¹¿ï¼šèµ«è²å¨œç»¿å®ç“¶ PROï¼ˆæŒ¤ 1 æ³µï¼Œåœ¨æ‰‹å¿ƒæ‰å¼€åè½»æŒ‰å…¨è„¸ï¼Œè°ƒèŠ‚æ°´æ²¹ï¼‰
# ï‚·é˜²æ™’ï¼šå…°è”»èçº¯é˜²æ™’éš”ç¦»ä¹³ï¼ˆPA++++ï¼Œè½»è–„ä¸é—·ç—˜ï¼Œæ¶‚å®Œç›´æ¥å‡ºé—¨ï¼‰
# ğŸŒ¿ æ—¥é—´å¼ºåŒ–ï¼š
# ï‚·åˆé¤åï¼šç”¨å¸æ²¹çº¸è½»æŒ‰ T åŒºï¼ˆåˆ«æ“¦ï¼æŒ‰æ‰æ²¹è„‚å°±è¡Œï¼‰
# ï‚·å®¤å†…ç©ºè°ƒæˆ¿ï¼šæ¡Œä¸Šæ”¾åŠ æ¹¿å™¨ï¼Œéšæ‰‹æ¶‚ç§‘é¢œæ°æ¶¦å”‡è†
# ğŸŒ™ æ™šé—´ä¿®æŠ¤ï¼š
# ï‚·æ¸…æ´ï¼šæ¯å‘¨ 2 æ¬¡ç”¨èµ«è²å¨œåŒé‡æŸ”è‚¤æ¶²ï¼ˆæ»´ 2 æ»´åœ¨æ£‰ç‰‡ï¼Œè½»æ“¦ T åŒºå»è§’è´¨ï¼‰
# ï‚·æ·¡æ–‘ï¼šå…°è”»èçº¯è‡»é¢œæ·¡æ–‘ç²¾åï¼ˆå– 1 æ»´ç®¡ï¼Œç‚¹åœ¨æ–‘ä¸Šæ‰“åœˆæŒ‰æ‘©ï¼‰
# ï‚·ä¿æ¹¿ï¼šç¾½è¥¿äººå‚ä¹³æ¶²ï¼ˆæ··åˆ 1 æ»´èµ«è²å¨œç»ç» A ç²¾åï¼Œå…¨è„¸æŒ‰å‹ï¼‰
# ğŸ’¡ è´´å¿ƒæé†’ï¼š
# é›¨å¤©è·¯æ»‘ï¼Œå‡ºé—¨ç©¿é˜²æ»‘é‹ï½æ™šä¸Šçœ‹ç”µè§†æ—¶ï¼Œç”¨æŒ‰æ‘©æ»šè½®ä»ä¸‹å¾€ä¸Šæ¨è„¸ 5 åˆ†é’Ÿï¼Œå»æ°´è‚¿ï½
# å…³é”®è®¾è®¡é€»è¾‘ï¼š
# 1.é€‚è€åŒ–è¡¨è¾¾ï¼š
# oç”¨ "æ‹ 3 é""1 å…ƒç¡¬å¸å¤§å°" ç­‰é‡åŒ–æŒ‡ä»¤ï¼Œé¿å… "å–é€‚é‡" ç­‰æ¨¡ç³Šè¯
# oå·¥å…·ä½¿ç”¨ç®€åŒ–ï¼šå¦‚ "ç”µåŠ¨æŒ‰æ‘©ä»ªä»ä¸‹å¾€ä¸Šæ¨" æ”¹ä¸º "ç”¨æ‰‹å¿ƒä»ä¸‹å·´å¾€ä¸Šæ‰"
# 2.å¤©æ°”è”åŠ¨ï¼š
# oç´«å¤–çº¿â‰¥3 çº§ï¼šå¼ºåˆ¶æé†’é˜²æ™’ + æˆ´å¸½å­
# oæ¹¿åº¦ï¼œ40%ï¼šå¢åŠ  "å–·é›¾è¡¥æ¹¿""é¢éœœåŠ é‡"
# oé«˜æ¸©ï¼30â„ƒï¼šæ¨èå•«å–± / ä¹³æ¶²è´¨åœ°ï¼Œå‡å°‘é¢éœœ
# 3.è‚¤è´¨å®šåˆ¶ï¼š
# oå¹²çš®ï¼šå…¨ç¨‹å¼ºè°ƒ "æ²¹åˆ†"ï¼ˆå¦‚é¢éœœå¤šå–ã€åŠ ç²¾åæ²¹ï¼‰
# oæ²¹çš®ï¼šä¾§é‡ "æ§æ²¹ + è½»è–„"ï¼ˆå¦‚ç»¿å®ç“¶ã€å¸æ²¹çº¸ï¼‰
# oæ•æ„Ÿè‚Œï¼šæ‰€æœ‰æ­¥éª¤æ ‡æ³¨ "è½»å‹""åˆ«æ“"ï¼Œé¿å¼€é…’ç²¾æˆåˆ†   

from dashscope import Application
from http import HTTPStatus
import json
import sys

#æŠ¤è‚¤agent
def skincare_agent(prompt):
    try:
        response = Application.call(
            api_key="sk-92c2e2b3481548fc9c82aa765268ddbc",
            app_id='7ed520dc4d8e4e7d825297db9bf9d86d',
            prompt=prompt,
            rag_options={
                "pipeline_ids": ["07d42855c8d443788d95040370bb6e80"],
            }
        )

        if response.status_code != HTTPStatus.OK:
            error_response = {
                "status": "error",
                "message": f"APIè°ƒç”¨å¤±è´¥: {response.message}",
                "code": response.status_code,
                "request_id": response.request_id
            }
            return json.dumps(error_response, ensure_ascii=False)

        # æˆåŠŸå“åº”
        success_response = {
            "status": "success",
            "intent": 2,  # 2è¡¨ç¤ºæŠ¤è‚¤å»ºè®®
            "recommendation": response.output.text
        }
        return json.dumps(success_response, ensure_ascii=False)

    except Exception as e:
        error_response = {
            "status": "error",
            "message": f"å‘ç”Ÿé”™è¯¯: {str(e)}"
        }
        return json.dumps(error_response, ensure_ascii=False)

def main():
    # æ£€æŸ¥æ˜¯å¦é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¼ å…¥è¾“å…¥
    if len(sys.argv) > 1:
        # ä»å‘½ä»¤è¡Œå‚æ•°è·å–è¾“å…¥
        user_input = sys.argv[1]
        try:
            result = skincare_agent(user_input)
            # ç›´æ¥è¾“å‡ºç»“æœï¼ˆå·²ç»æ˜¯JSONå­—ç¬¦ä¸²ï¼‰
            print(result)
        except Exception as e:
            print(json.dumps({
                "status": "error",
                "message": str(e)
            }, ensure_ascii=False))
    else:
        # äº¤äº’å¼æ¨¡å¼
        print("æ¬¢è¿ä½¿ç”¨æ™ºèƒ½æŠ¤è‚¤åŠ©æ‰‹ï¼")
        print("æ‚¨å¯ä»¥è¯¢é—®ï¼š")
        print("- ä»Šæ—¥æŠ¤è‚¤å»ºè®®")
        print("- ç‰¹å®šè‚¤è´¨æŠ¤ç†æ–¹æ³•")
        print("- äº§å“ä½¿ç”¨å»ºè®®")
        print("è¾“å…¥ 'q' é€€å‡ºç¨‹åº")
        
        while True:
            user_input = input("\nè¯·è¾“å…¥æ‚¨çš„é—®é¢˜: ").strip()
            
            if user_input.lower() == 'q':
                print("æ„Ÿè°¢ä½¿ç”¨ï¼Œå†è§ï¼")
                break
                
            if not user_input:
                print("è¾“å…¥ä¸èƒ½ä¸ºç©º")
                continue
                
            try:
                print("\næ­£åœ¨å¤„ç†æ‚¨çš„é—®é¢˜...")
                result = skincare_agent(user_input)
                result_dict = json.loads(result)
                
                if result_dict["status"] == "success":
                    print("\næŠ¤è‚¤å»ºè®®ï¼š")
                    print("-" * 50)
                    print(result_dict["recommendation"])
                    print("-" * 50)
                else:
                    print(f"å¤„ç†å‡ºé”™: {result_dict.get('message', 'æœªçŸ¥é”™è¯¯')}")
                
            except Exception as e:
                print(f"å¤„ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: {str(e)}")

if __name__ == "__main__":
    main()
    
